<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Check Data Usage</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 40px;
      background-color: #f4f4f4;
      text-align: center;
    }

    .logo-container {
      text-align: center;
      margin-bottom: 20px;
    }

    .logo-container img {
      width: 120px;
      max-width: 40%;
      height: auto;
      border-radius: 10px;
      object-fit: contain;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .container {
      background: #fff;
      padding: 30px;
      border-radius: 12px;
      max-width: 500px;
      margin: auto;
      box-shadow: 0 0 10px rgb(29, 125, 252);
    }

    input {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      margin-top: 10px;
      margin-bottom: 20px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }

    button {
      padding: 10px 20px;
      font-size: 16px;
      background-color: #007bff;
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    #result {
      margin-top: 25px;
    }

    /* زر واتساب ثابت */
    .whatsapp-inline {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 10px 18px;
  background-color: #25D366;
  color: white;
  border-radius: 30px;
  font-weight: bold;
  text-decoration: none;
  margin-bottom: 20px;
  transition: background-color 0.3s;
}

.whatsapp-inline img {
  width: 20px;
  height: 20px;
}

.whatsapp-inline:hover {
  background-color: #1ebe5d;
}

    .whatsapp-float img {
      width: 24px;
      height: 24px;
      margin-right: 10px;
    }

    .whatsapp-float:hover {
      background-color: #1ebe5d;
    }
  </style>
</head>
<body>

  <!-- شعار الشركة -->
  <div class="logo-container">
    <img src="https://j.top4top.io/p_3399iqm8l1.png" alt="Company Logo">
  </div>

  <!-- زر واتساب ثابت -->
  <a href="https://wa.me/97336636509" target="_blank" class="whatsapp-inline">
    <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp">
    WhatsApp
  </a>

  <!-- نموذج البحث -->
  <div class="container">
    <h2>Check Data Usage</h2>
    <input type="text" id="iccid" placeholder="Enter ICCID">
    <button onclick="checkData()">Check</button>
    <div id="result"></div>
  </div>

  <script>
    async function checkData() {
      const iccid = document.getElementById("iccid").value.trim();
      const resultDiv = document.getElementById("result");

      if (!iccid) {
        resultDiv.innerHTML = '<p style="color:red;">Please enter ICCID.</p>';
        return;
      }

      try {
        const response = await fetch(`https://api.esim-go.com/v2.4/esims/${iccid}/bundles`, {
          method: 'GET',
          headers: {
            'X-API-Key': 'WASne7TcbZ9qtrjhfxEe2VEDwlhbsGgBFSDJkmul'
          }
        });

        if (!response.ok) throw new Error("Failed to fetch data from API");

        const data = await response.json();
        console.log("API Response:", data);

        if (data && data.bundles && data.bundles.length > 0) {
          const bundle = data.bundles[0];
          const assignment = bundle.assignments?.[0];

          if (assignment) {
            const initial = assignment.initialQuantity;
            const remaining = assignment.remainingQuantity;
            const usedBytes = initial - remaining;

            const usedGB = (usedBytes / (1024 ** 3)).toFixed(2);
            const remainingGB = (remaining / (1024 ** 3)).toFixed(2);
            const totalGB = (initial / (1024 ** 3)).toFixed(2);
            const percentage = ((usedBytes / initial) * 100).toFixed(1);


            const endDate = new Date(assignment.endTime);
            const expiryFormatted = `${endDate.getDate().toString().padStart(2, '0')}/${
              (endDate.getMonth() + 1).toString().padStart(2, '0')
            }/${endDate.getFullYear()} ${endDate.getHours().toString().padStart(2, '0')}:${endDate.getMinutes().toString().padStart(2, '0')}`;

            resultDiv.innerHTML = `
              <div style="background:#f9f9f9; padding:20px; border-radius:10px; border:1px solid #ddd;">
                <p><strong>ICCID:</strong> ${iccid}</p>
                <p><strong>Data Usage:</strong> ${usedGB} GB</p>
                <div style="background:#e0e0e0; border-radius:20px; overflow:hidden; height:20px; margin:10px 0;">
                  <div style="width:${percentage}%; background:#4caf50; height:100%;"></div>
                </div>
                <p><strong>Data Balance:</strong> ${remainingGB} GB</p>
                <p><strong>Expiry Date:</strong> ${expiryFormatted}</p>
              </div>
            `;
          } else {
            resultDiv.innerHTML = '<p style="color:red;">No assignment data found for this ICCID.</p>';
          }
        } else {
          resultDiv.innerHTML = '<p style="color:red;">No data available for this ICCID.</p>';
        }

      } catch (error) {
        console.error(error);
        resultDiv.innerHTML = '<p style="color:red;">Error: Failed to fetch data from API</p>';
      }
    }
  </script>

</body>
</html>
